{% extends 'base.html' %}

{% load staticfiles %}    
{% load date_time_diff_tags %}

{% block content %} 
    <div class="search-container">
      <div> 
        <table class = "table" id="myTable1" border="2">
          <thead>
            <tr>
              <th>Time details</th>
              <th>User</th>
              <th>Employee ID</th>
              <th>Date</th>
              <th>Calculation</th>
              {% if user.is_superuser  %}
              <th scope="col" class="action-checkbox-column">
              <div class="text"><span><input type="checkbox" id="checkall"></span></div>
              <div class="clear"></div>
              {% endif %}
              </th>   
            </tr>
          </thead>
          <tbody class="mychkboxs">
            {% for attendance in attendances_data %}
              <tr>
                <td><a class="attendence_datetime" href="" data-employee-id="{{ attendance.employee_id }}" data-date="{{ attendance.date }}">View</a></td>
                <td><p>{{ attendance.user }}</p></td>
                <td>{{ attendance.employee_id }}</td>
                <td>{{ attendance.date }}</td>
                <td><p>{% get_date_time_diff_tag  request attendance.date attendance.user %}</p></td> 
                <td class="action-checkbox">
                  <input type="checkbox" name="record" value="{{ attendance.pk }}" class="action-select">
               </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      <button class="btn btn-success delete-row" id="delrow">Delete row</button>
    </div>

  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-body" id="attendence_model">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>



  <script>
    $(document).ready(function(){
      $(".attendence_datetime").click(function(e){
        e.preventDefault();
        var dat = $(this).data("date");
        var emp_id = $(this).data("employee-id");
        $.ajax({
           'url': "{% url "employee:date-time-attendence-view" %}",
           'type': "POST",
           // 'dataType': 'json',
           'data': {

               'dat': dat,

               
               'emp_id':emp_id,
               'csrfmiddlewaretoken': '{{ csrf_token }}',
           },

           success: function( data, textStatus, jQxhr )
           {
                $("#attendence_model").html(data);
                $("#myModal").modal();
            },
            error: function( jqXhr, textStatus, errorThrown ){
                console.log( errorThrown );
            }
        });
        
      });
    });
  </script>

{% endblock %}
